<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Job Interview Simulator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .typing-indicator {
            display: none;
            padding: 10px;
        }
        .typing-indicator.visible {
            display: flex;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            margin: 0 2px;
            background-color: #6b7280;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.4;
        }
        .typing-indicator span:nth-child(1) {
            animation: bounce 1s infinite;
        }
        .typing-indicator span:nth-child(2) {
            animation: bounce 1s infinite 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation: bounce 1s infinite 0.4s;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            50% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }
        .message-content ul {
            list-style-type: disc;
            padding-left: 20px;
            margin: 10px 0;
        }
        .message-content li {
            margin-bottom: 5px;
        }
        #voice-btn.recording {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        #webcam-feedback {
            transition: all 0.3s ease;
        }
        .feedback-positive {
            border-color: #10B981 !important;
        }
        .feedback-negative {
            border-color: #EF4444 !important;
        }
        .feedback-neutral {
            border-color: #3B82F6 !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex items-center">
                <div class="flex items-center">
                    <div class="bg-blue-500 text-white p-3 rounded-lg mr-4">
                        <i class="fas fa-user-tie text-xl"></i>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900">AI Job Interview Simulator</h1>
                </div>
            </div>
        </header>

        <main class="flex-grow flex flex-col md:flex-row max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 gap-6">
            <!-- Left column - Webcam and analysis -->
            <div class="w-full md:w-1/3 lg:w-1/4 space-y-4">
                <div class="bg-white rounded-lg shadow p-4">
                    <h2 class="text-lg font-medium mb-4">Video Feedback</h2>
                    <div id="webcam-container" class="relative">
                        <video id="webcam" autoplay playsinline class="w-full h-auto rounded-lg border-4 border-blue-500" style="transform: scaleX(-1);"></video>
                        <div id="webcam-feedback" class="absolute inset-0 border-4 rounded-lg pointer-events-none"></div>
                    </div>
                    <div class="mt-4">
                        <button id="toggle-webcam" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition">
                            <i class="fas fa-video mr-2"></i> Enable Webcam
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-4">
                    <h2 class="text-lg font-medium mb-4">Interview Analysis</h2>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Confidence</span>
                                <span id="confidence-score" class="text-sm">--%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="confidence-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Eye Contact</span>
                                <span id="eye-contact-score" class="text-sm">--%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="eye-contact-bar" class="bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Speech Clarity</span>
                                <span id="speech-score" class="text-sm">--%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="speech-bar" class="bg-purple-500 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div id="feedback-text" class="mt-4 p-3 bg-gray-50 rounded-lg text-sm">
                        Enable webcam and microphone to receive real-time feedback on your interview performance.
                    </div>
                </div>
            </div>

            <!-- Right column - Chat interface -->
            <div class="flex-grow flex flex-col">
                <div class="bg-white rounded-lg shadow flex-grow flex flex-col">
                    <div id="intro" class="bg-blue-50 p-4 rounded-t-lg flex items-start">
                        <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                        <p id="intro-text" class="text-sm text-blue-800">Welcome to the AI Job Interview Simulator! Upload your resume (PDF or text) to start a mock interview with real-time video feedback.</p>
                    </div>

                    <div id="chat-box" class="flex-grow p-4 overflow-y-auto space-y-4" style="max-height: 500px;">
                        <div class="flex items-start">
                            <div class="bg-gray-100 p-3 rounded-lg mr-4">
                                <i class="fas fa-robot text-gray-600"></i>
                            </div>
                            <div class="bg-gray-100 rounded-lg p-3 max-w-3/4">
                                <p>Please upload your resume (PDF or text) to begin the interview simulation!</p>
                            </div>
                        </div>
                        <div class="typing-indicator pl-16">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>

                    <div class="border-t p-4">
                        <div class="flex space-x-2 mb-2">
                            <input type="text" 
                                   id="user-input" 
                                   placeholder="Type your answer here..." 
                                   class="flex-grow border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   autocomplete="off">
                            <button id="send-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="flex space-x-2">
                            <button id="voice-btn" class="flex-grow bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">
                                <i class="fas fa-microphone mr-2"></i> Speak
                            </button>
                            <button id="upload-btn" class="flex-grow bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">
                                <i class="fas fa-upload mr-2"></i> Upload Resume
                            </button>
                            <input type="file" id="file-input" accept=".pdf,.txt" class="hidden">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        $(document).ready(function() {
            // Webcam variables
            let webcamStream = null;
            let isWebcamOn = false;
            let feedbackInterval = null;
            
            // DOM elements
            const webcamVideo = document.getElementById('webcam');
            const toggleWebcamBtn = document.getElementById('toggle-webcam');
            const webcamFeedback = document.getElementById('webcam-feedback');
            
            // Typing indicator functions
            function showTypingIndicator() {
                $(".typing-indicator").addClass("visible");
            }
            
            function hideTypingIndicator() {
                $(".typing-indicator").removeClass("visible");
            }
            
            // Message functions
            function addMessage(text, sender) {
                hideTypingIndicator();
                
                const isBot = sender === 'bot';
                const messageClass = isBot ? 'flex items-start' : 'flex items-start flex-row-reverse';
                const bubbleClass = isBot ? 'bg-gray-100 mr-4' : 'bg-blue-500 text-white ml-4';
                const iconClass = isBot ? 'bg-gray-100 p-3 rounded-lg mr-4' : 'bg-blue-500 text-white p-3 rounded-lg ml-4';
                const icon = isBot ? '<i class="fas fa-robot text-gray-600"></i>' : '<i class="fas fa-user text-white"></i>';
                
                // Format text with basic markdown
                let formattedText = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code class="bg-gray-200 px-1 rounded">$1</code>')
                    .replace(/^- (.*)$/gm, '<li>$1</li>')
                    .replace(/^(?!<li>)(.*)$/gm, '$1<br>');
                
                // Wrap lists in ul tags
                formattedText = formattedText.replace(/<li>(.*)/g, function(match) { 
                    return '<ul class="list-disc pl-5 space-y-1">' + match + '</ul>'; 
                });
                
                // Remove trailing <br> tags
                formattedText = formattedText.replace(/<br>\s*$/, '');
                
                const messageDiv = $(`
                    <div class="${messageClass}">
                        <div class="${iconClass}">
                            ${icon}
                        </div>
                        <div class="${bubbleClass} rounded-lg p-3 max-w-3/4">
                            ${formattedText}
                        </div>
                    </div>
                `);
                
                $("#chat-box").append(messageDiv);
                $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                
                // Simulate analysis feedback when user sends message
                if (!isBot) {
                    simulateAnalysisFeedback();
                }
            }
            
            function resetChat() {
                $("#chat-box").empty();
                addMessage("Please upload your resume (PDF or text) to begin the interview simulation!", "bot");
            }
            
            // Webcam functions
            async function toggleWebcam() {
                try {
                    if (isWebcamOn) {
                        // Turn off webcam
                        if (webcamStream) {
                            webcamStream.getTracks().forEach(track => track.stop());
                        }
                        webcamVideo.srcObject = null;
                        isWebcamOn = false;
                        toggleWebcamBtn.innerHTML = '<i class="fas fa-video mr-2"></i> Enable Webcam';
                        toggleWebcamBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                        toggleWebcamBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
                        
                        // Clear feedback interval
                        if (feedbackInterval) {
                            clearInterval(feedbackInterval);
                            feedbackInterval = null;
                        }
                        
                        // Reset feedback UI
                        webcamFeedback.className = 'absolute inset-0 border-4 rounded-lg pointer-events-none';
                        $('#feedback-text').text('Webcam disabled. Enable to receive real-time feedback.');
                    } else {
                        // Turn on webcam
                        webcamStream = await navigator.mediaDevices.getUserMedia({ 
                            video: true, 
                            audio: false 
                        });
                        webcamVideo.srcObject = webcamStream;
                        isWebcamOn = true;
                        toggleWebcamBtn.innerHTML = '<i class="fas fa-video-slash mr-2"></i> Disable Webcam';
                        toggleWebcamBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                        toggleWebcamBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                        
                        // Start feedback simulation
                        startFeedbackAnalysis();
                        
                        $('#feedback-text').text('Webcam enabled. Analysis in progress...');
                    }
                } catch (err) {
                    console.error("Error accessing webcam:", err);
                    $('#feedback-text').text('Error accessing webcam. Please check permissions.');
                }
            }
            
            function startFeedbackAnalysis() {
                // This would be replaced with real face/expression analysis
                // For now, we'll simulate random feedback
                if (feedbackInterval) {
                    clearInterval(feedbackInterval);
                }
                
                feedbackInterval = setInterval(() => {
                    simulateVideoFeedback();
                }, 3000);
            }
            
            function simulateVideoFeedback() {
                if (!isWebcamOn) return;
                
                // Simulate different feedback states
                const states = [
                    { class: 'feedback-positive', text: 'Good eye contact and confident posture!' },
                    { class: 'feedback-neutral', text: 'Try to maintain more consistent eye contact.' },
                    { class: 'feedback-negative', text: 'You seem nervous. Try to relax your shoulders.' }
                ];
                
                const randomState = states[Math.floor(Math.random() * states.length)];
                
                // Update feedback UI
                webcamFeedback.className = `absolute inset-0 border-4 rounded-lg pointer-events-none ${randomState.class}`;
                $('#feedback-text').text(randomState.text);
                
                // Update metrics with random values (simulated)
                const confidence = Math.min(100, Math.max(0, Math.floor(Math.random() * 20) + 70));
                const eyeContact = Math.min(100, Math.max(0, Math.floor(Math.random() * 25) + 60));
                const speech = Math.min(100, Math.max(0, Math.floor(Math.random() * 15) + 75));
                
                $('#confidence-score').text(`${confidence}%`);
                $('#confidence-bar').css('width', `${confidence}%`);
                
                $('#eye-contact-score').text(`${eyeContact}%`);
                $('#eye-contact-bar').css('width', `${eyeContact}%`);
                
                $('#speech-score').text(`${speech}%`);
                $('#speech-bar').css('width', `${speech}%`);
            }
            
            function simulateAnalysisFeedback() {
                // Simulate analysis when user sends a message
                if (isWebcamOn) {
                    setTimeout(() => {
                        const feedbacks = [
                            "Your answer was clear and concise. Good job!",
                            "Try to provide more specific examples from your experience.",
                            "Your response was a bit short. Consider expanding with more details.",
                            "Excellent use of industry terminology in your response.",
                            "Watch for filler words like 'um' and 'ah' in your answers."
                        ];
                        
                        const randomFeedback = feedbacks[Math.floor(Math.random() * feedbacks.length)];
                        $('#feedback-text').text(randomFeedback);
                        
                        // Randomly adjust metrics slightly
                        adjustMetricRandomly('confidence-bar', 'confidence-score');
                        adjustMetricRandomly('eye-contact-bar', 'eye-contact-score');
                        adjustMetricRandomly('speech-bar', 'speech-score');
                    }, 1500);
                }
            }
            
            function adjustMetricRandomly(barId, scoreId) {
                const bar = $(`#${barId}`);
                const currentWidth = parseInt(bar.css('width'));
                const currentScore = parseInt($(`#${scoreId}`).text());
                
                // Adjust by Â±5-15%
                const adjustment = (Math.random() > 0.5 ? 1 : -1) * (5 + Math.floor(Math.random() * 10));
                let newScore = currentScore + adjustment;
                newScore = Math.min(100, Math.max(0, newScore));
                
                $(`#${scoreId}`).text(`${newScore}%`);
                bar.css('width', `${newScore}%`);
            }
            
            // Chat functions
            function sendMessage(message) {
                showTypingIndicator();
                
                if (message.toLowerCase().trim() === "restart") {
                    setTimeout(function() {
                        hideTypingIndicator();
                        resetChat();
                        addMessage("Interview has been restarted. Please upload a new resume!", "bot");
                        speak("Interview has been restarted. Please upload a new resume!");
                    }, 1000);
                    return;
                }
                
                setTimeout(function() {
                    // In a real app, this would be an AJAX call to your backend
                    // For demo purposes, we'll simulate responses
                    const simulatedResponses = [
                        "That's an interesting perspective. Can you tell me more about how you applied that in your previous role?",
                        "Thank you for sharing that. What would you say was your biggest challenge in that situation?",
                        "I appreciate your answer. How do you think this experience prepares you for this position?",
                        "That's a good point. Can you give me an example of when you demonstrated that skill?",
                        "Interesting. How would you handle this differently if you faced the same situation again?"
                    ];
                    
                    const randomResponse = simulatedResponses[Math.floor(Math.random() * simulatedResponses.length)];
                    
                    setTimeout(() => {
                        addMessage(randomResponse, "bot");
                        speak(randomResponse);
                    }, 1000 + Math.random() * 2000); // Random delay between 1-3 seconds
                }, 1000);
            }
            
            // Event listeners
            $("#send-btn").click(function() {
                const userMessage = $("#user-input").val().trim();
                if (userMessage === "") return;
                
                addMessage(userMessage, "user");
                $("#user-input").val("");
                sendMessage(userMessage);
            });
            
            $("#user-input").keypress(function(e) {
                if (e.which === 13) {
                    $("#send-btn").click();
                }
            });
            
            $("#upload-btn").click(function() {
                $("#file-input").click();
            });
            
            $("#file-input").change(function() {
                const file = this.files[0];
                if (!file) return;
                
                showTypingIndicator();
                addMessage(`Resume uploaded: ${file.name}`, "user");
                
                // Simulate processing delay
                setTimeout(() => {
                    const welcomeMessages = [
                        "Thank you for uploading your resume. I see you have experience in several relevant areas. Let's begin the interview. Tell me about yourself.",
                        "I've reviewed your background. Let's start with you walking me through your most recent position.",
                        "Based on your resume, you have an interesting background. Can you tell me about a project you're particularly proud of?",
                        "Your experience looks impressive. How would you describe your work style to someone who's never worked with you before?"
                    ];
                    
                    const randomWelcome = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
                    addMessage(randomWelcome, "bot");
                    speak(randomWelcome);
                }, 2000);
                
                $(this).val("");
            });
            
            // Voice recognition
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                const recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    $("#user-input").val(transcript);
                    $("#send-btn").click();
                    $("#voice-btn").removeClass("recording");
                };
                
                recognition.onerror = function(event) {
                    console.error("Speech recognition error:", event.error);
                    $("#voice-btn").removeClass("recording");
                };
                
                recognition.onend = function() {
                    $("#voice-btn").removeClass("recording");
                };
                
                $("#voice-btn").click(function() {
                    if ($(this).hasClass("recording")) {
                        recognition.stop();
                    } else {
                        recognition.lang = "en-US";
                        recognition.start();
                        $(this).addClass("recording");
                    }
                });
            } else {
                $("#voice-btn").prop("disabled", true).addClass("opacity-50 cursor-not-allowed")
                    .html('<i class="fas fa-microphone-slash mr-2"></i> Voice Not Supported');
            }
            
            // Webcam toggle
            toggleWebcamBtn.addEventListener('click', toggleWebcam);
            
            // Text-to-speech
            function speak(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = "en-US";
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            }
        });
    </script>
</body>
</html>